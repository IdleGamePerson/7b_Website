<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Die 7b Website</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #7f7f7f;
    }
    header {
      height: 5vh;
      background-color: #222;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      box-sizing: border-box;
    }
    .menu-buttons button {
      margin-left: 10px;
      padding: 5px 10px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
    }
    .menu-buttons button:hover {
      background-color: #666;
    }
    #content {
      height: 95vh;
      overflow-y: auto;
      padding: 20px;
      box-sizing: border-box;
    }
    .stat {
      margin: 10px 0;
    }
    .article-summary {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      cursor: pointer;
    }
    .article-summary img {
      height: 100px;
      display: block;
      margin-top: 10px;
    }
    .article-full {
      border: 1px solid #888;
      padding: 15px;
      margin: 10px 0;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    select, input[type="text"] {
      padding: 10px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <div>Die 7b Website</div>
    <div class="menu-buttons">
      <button onclick="switchMenu('hauptseite')">Hauptseite</button>
      <button onclick="switchMenu('artikel')">Artikel</button>
      <button onclick="switchMenu('news')">News</button>
      <button onclick="switchMenu('plaene')">Pläne</button>
    </div>
  </header>

  <div id="content"></div>

  <script>
    function berechne7bFaktor(v) {
      const s = v[0]*Math.abs(v[0]) + v[1]*Math.abs(v[1]) + v[2]*Math.abs(v[2]);
      return (s === 0 ? 0 : (Math.sign(s) * Math.sqrt(Math.abs(s)/3))).toFixed(3);
    }
    const kategorienFarben = {
      'Klassenarbeiten': '#cce6ff',
      'Intelligenzallergie': '#ffff99',
      'Events': '#ccffcc',
      'Lehrer': '#ffcc99',
      'Hausaufgaben': '#99ff99',
      'Gaming': '#ff9999',
      'Besseres Gaming': '#cc99ff',
      'Antimaterie': '#9999ff',
      'Was auch immer': '#cccccc'
    };

    const artikelDaten = [
      {
        titel: 'An object',
        kategorie: 'Was auch immer',
        vektor: [0.76, -0.04, 0.69],
        bild: 'dreieck.jpg',
        text: 'An object ist ein Objekt. Niemand weiß genau, was für ein Objekt, aber es ist ein Objekt.'
      }
    ];

    const newsDaten = [
      {
        titel: 'Physik Klassenarbeit',
        kategorie: 'Klassenarbeiten',
        vektor: [-0.29, 0.24, -0.18],
        bild: 'https://via.placeholder.com/150',
        text: 'Die Physik-Klassenarbeit wurde geschrieben, was die sechste KA in diesem Monat bedeutet.<br>Hier ist ein bisschen Motivation: Am <b><i>6. Juni</i></b> starten die Pfingstferien!',
        datum: '2025-05-28'
      }
    ];
    
    const wochentage = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
    const monatNamen = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];

    function formatDatum(datumStr) {
      const d = new Date(datumStr);
      return `${wochentage[d.getDay()]}, ${d.getDate()}. ${monatNamen[d.getMonth()]} ${d.getFullYear()}`;
    }

    let currentMenu = 'hauptseite';
    let currentArticle = null;
    let searchQuery = '';
    let sortMode = 'random';

    const basisplan = {
      Montag: [
        ['07:50', '09:20', 'Religion R112/evangelisch R108/Ethik R302 [Wahl]'],
        ['09:35', '10:20', 'Latein R307/Englisch R112 [Intensivierung]'],
        ['10:20', '11:05', 'Englisch R020/Latein R302 [Intensivierung]'],
        ['11:20', '12:05', 'Kunst R012'],
        ['12:10', '12:55', 'Kunst R012']
      ],
      Dienstag: [
        ['07:50', '09:20', 'Sport'],
        ['09:35', '10:20', 'Deutsch R111'],
        ['10:20', '11:05', 'Musik R005'],
        ['11:20', '12:05', 'Mathe R306'],
        ['12:10', '12:55', 'Informatik R014']
      ],
      Mittwoch: [
        ['07:50', '09:20', 'Mathe R112'],
        ['09:35', '10:20', 'Geschichte R112'],
        ['10:20', '11:05', 'Latein R112'],
        ['11:20', '12:05', 'Musik R006'],
        ['14:00', '14:45', 'Biologie R214'],
        ['14:50', '15:35', 'Biologie R214'],
        ['15:45', '16:30', 'Physik R313'],
        ['16:35', '17:20', 'Physik R313']
      ],
      Donnerstag: [
        ['07:50', '09:20', 'Englisch R109'],
        ['09:35', '11:05', 'Deutsch R111'],
        ['11:20', '12:05', 'Latein R110'],
        ['12:10', '12:55', 'Latein R110']
      ],
      Freitag: [
        ['07:50', '08:35', 'Mathe R112'],
        ['08:35', '09:20', 'Geschichte R112'],
        ['09:35', '10:20', 'Deutsch R006'],
        ['10:20', '11:05', 'Latein R006'],
        ['11:20', '12:05', 'Englisch R304'],
        ['14:00', '14:45', 'Geographie R209'],
        ['14:50', '15:35', 'Geographie R209'],
        ['15:45', '16:30', 'Sport'],
        ['16:35', '17:20', 'Sport']
      ]
    };

    const wochentageLang = ['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];

    function switchMenu(menu) {
      currentMenu = menu;
      currentArticle = null;
      searchQuery = '';
      renderContent();
    }

    function showArticle(index) {
      currentArticle = index;
      renderContent();
    }

    function sortArticles(daten) {
      function rawFaktor(v) {
        return v[0]*Math.abs(v[0]) + v[1]*Math.abs(v[1]) + v[2]*Math.abs(v[2]);
      }
      let sorted = [...daten];
      switch (sortMode) {
        case 'a-z':
          sorted.sort((a, b) => a.titel.localeCompare(b.titel));
          break;
        case 'z-a':
          sorted.sort((a, b) => b.titel.localeCompare(a.titel));
          break;
        case 'v1-down':
          sorted.sort((a, b) => b.vektor[0] - a.vektor[0]);
          break;
        case 'v1-up':
          sorted.sort((a, b) => a.vektor[0] - b.vektor[0]);
          break;
        case 'v2-down':
          sorted.sort((a, b) => b.vektor[1] - a.vektor[1]);
          break;
        case 'v2-up':
          sorted.sort((a, b) => a.vektor[1] - b.vektor[1]);
          break;
        case 'v3-down':
          sorted.sort((a, b) => b.vektor[2] - a.vektor[2]);
          break;
        case 'v3-up':
          sorted.sort((a, b) => a.vektor[2] - b.vektor[2]);
          break;
        case 'date-newest':
          sorted.sort((a, b) => new Date(b.datum) - new Date(a.datum));
          break;
        case 'date-oldest':
          sorted.sort((a, b) => new Date(a.datum) - new Date(b.datum));
          break;
        case 'faktor-down':
          sorted.sort((a, b) => rawFaktor(b.vektor) - rawFaktor(a.vektor));
          break;
        case 'faktor-up':
          sorted.sort((a, b) => rawFaktor(a.vektor) - rawFaktor(b.vektor));
          break;
        default:
          sorted.sort(() => Math.random() - 0.5);
      }
      return sorted;
    }

    function renderContent() {
      function formatDauer(minuten) {
        minuten = Math.round(minuten);
        const tage = Math.floor(minuten / 1440);
        minuten %= 1440;
        const stunden = Math.floor(minuten / 60);
        const restMinuten = minuten % 60;
        let parts = [];
        if (tage > 0) parts.push(tage + ' T');
        if (stunden > 0) parts.push(stunden + ' h');
        if (restMinuten > 0 || parts.length === 0) parts.push(restMinuten + ' Min');
        return parts.join(' ');
      }
      if (currentMenu === 'plaene') {
        const content = document.getElementById('content');
        content.innerHTML = '';

        const now = new Date();
        const events = [];
        const aenderungen = [
          {
            datum: '2025-05-30',
            start: '07:50',
            end: '17:20',
            fach: 'efhjnzugrv'
          },
          {
            datum: '2025-06-02',
            start: '07:50',
            end: '09:20',
            fach: 'Religion R112/evangelisch R108/Ethik R302 Klassenarbeit [Wahl]'
          },
          {
            datum: '2025-06-04',
            start: '07:50',
            end: '09:20',
            fach: 'Mathe R112 Klassenarbeit'
          },
          {
            datum: '2025-06-04',
            start: '09:35',
            end: '10:20',
            fach: 'Geschichte R109'
          },
          {
            datum: '2025-06-04',
            start: '10:20',
            end: '11:05',
            fach: 'Latein R110'
          },
          {
            datum: '2025-06-05',
            start: '09:35',
            end: '11:05',
            fach: 'Latein R305'
          },
          {
            datum: '2025-06-05',
            start: '11:20',
            end: '12:55',
            fach: 'efhjnzugrv'
          },
          {
            datum: '2025-06-06',
            start: '07:50',
            end: '08:35',
            fach: 'Geschichte R112'
          },
          {
            datum: '2025-06-06',
            start: '08:35',
            end: '09:20',
            fach: 'Mathe R112'
          },
          {
            datum: '2025-06-09', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-10', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-11', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-12', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-13', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-16', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-17', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-18', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-19', start: '07:50', end: '17:20', fach: 'efhjnzugrv' },
          {
            datum: '2025-06-20', start: '07:50', end: '17:20', fach: 'efhjnzugrv' }
        ];
        let count = 0;
        let day = new Date(now);

        while (events.length < 150) {
          const wtag = wochentageLang[day.getDay()];
          const tagStr = day.toISOString().split('T')[0];
          let basis = basisplan[wtag] ? [...basisplan[wtag]] : [];

          // Änderungen anwenden
          aenderungen.forEach(a => {
            if (a.datum === tagStr) {
              const aStart = a.start;
              const aEnd = a.end;
              const newFach = a.fach;

              let neuBasis = [];
              basis.forEach(([start, end, fach]) => {
                if (end <= aStart || start >= aEnd) {
                  neuBasis.push([start, end, fach]);
                } else {
                  if (start < aStart) neuBasis.push([start, aStart, fach]);
                  if (end > aEnd) neuBasis.push([aEnd, end, fach]);
                }
              });
              basis = neuBasis;

              if (newFach !== 'efhjnzugrv') {
                basis.push([aStart, aEnd, newFach]);
              }
            }
          });
          basis.sort((a, b) => a[0].localeCompare(b[0]));

          basis.forEach(([start, end, fach]) => {
            const [sh, sm] = start.split(':').map(Number);
            const startTime = new Date(day);
            startTime.setHours(sh, sm, 0, 0);

            if (startTime >= now || events.length > 0) {
              events.push({ fach, start, end, tag: day.toDateString(), datetime: startTime });
            }
          });

          day.setDate(day.getDate() + 1);
        }

        events.sort((a, b) => a.datetime - b.datetime);
        const top = document.createElement('div');
        top.innerHTML = '<h2>Nächste 150 Ereignisse</h2>';
        content.appendChild(top);

        let prevEnd = new Date(now); // initiale Pause prüfen
        events.slice(0, 150).forEach(e => {
          const start = new Date(e.datetime);
          const [eh, em] = e.end.split(':').map(Number);
          const end = new Date(start);
          end.setHours(eh, em);

          if (prevEnd && start > prevEnd) {
            const fullGapMin = (start - prevEnd) / 60000;
            const gapMin = Math.min(fullGapMin, 400); // Maxhöhe 400px
            const gapBox = document.createElement('div');
            gapBox.style = `height: ${gapMin}px; background: #555; margin: 2px 0; font-size: 10px; text-align: center; color: #000; display: flex; align-items: center; justify-content: center;`;
            gapBox.textContent = formatDauer(fullGapMin) + ' Pause';
            content.appendChild(gapBox);
          }

          const fullDauerMin = (end - start) / 60000;
          const dauerMin = Math.min(fullDauerMin, 400); // Maxhöhe 400px
          const box = document.createElement('div');
          box.style = `height: ${dauerMin}px; border: 1px solid #333; padding: 2px 10px; margin: 2px 0; background: #666; display: flex; justify-content: space-between; align-items: center; font-size: 14px;`;
          const d = new Date(e.datetime);
          const tagDeutsch = `${wochentage[d.getDay()]}, ${d.getDate()}. ${monatNamen[d.getMonth()]} ${d.getFullYear()}`;
          box.innerHTML = `<div>${e.fach} (${formatDauer(fullDauerMin)})</div><div>${tagDeutsch}, ${e.start}–${e.end}</div>`;
          content.appendChild(box);
          prevEnd = end;
        });
        return;
      }
      function showRandomArticle() {
        const datenSet = currentMenu === 'artikel' ? artikelDaten : newsDaten;
        if (datenSet.length > 0) {
          const randomIndex = Math.floor(Math.random() * datenSet.length);
          showArticle(randomIndex);
        }
      }
      const content = document.getElementById('content');

      if (currentMenu === 'hauptseite') {
        content.innerHTML = '';
        const text = document.createElement('div');
        text.innerHTML = '<b>Willkommen</b> bei der <i>legendären</i> 7b. Wir sind die <u>Besten</u>!';

        const stats = document.createElement('div');
        stats.innerHTML = `
          <div class="stat">Typen in 7b: 26</div>
          <div class="stat">Existenzsekunden der 7b: <span id="existenz"></span></div>
          <div class="stat">Bester Geldklicker Speedrun: 27:49,11</div>
        `;

        content.appendChild(text);
        content.appendChild(stats);

        const startTime = new Date('2024-09-09T07:50:00');
        setInterval(() => {
          const now = new Date();
          const diff = Math.floor((now - startTime) / 1000);
          document.getElementById('existenz').textContent = diff;
        }, 1000);

      } else {
        const daten = currentMenu === 'artikel' ? artikelDaten : newsDaten;

        if (currentArticle === null) {
          content.innerHTML = '';

          const controls = document.createElement('div');
          controls.className = 'controls';

          const searchBox = document.createElement('input');
          searchBox.type = 'text';
          searchBox.placeholder = 'Artikel suchen...';
          searchBox.value = searchQuery;

          searchBox.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            renderArticleList();
          });

          const select = document.createElement('select');
          select.innerHTML = `
            <option value="random">Zufällig</option>
            <option value="a-z">Alphabetisch A zu Z</option>
            <option value="z-a">Alphabetisch Z zu A</option>
            <option value="v1-down">1. Vektorzahl 1 zu -1</option>
            <option value="v1-up">1. Vektorzahl -1 zu 1</option>
            <option value="v2-down">2. Vektorzahl 1 zu -1</option>
            <option value="v2-up">2. Vektorzahl -1 zu 1</option>
            <option value="v3-down">3. Vektorzahl 1 zu -1</option>
            <option value="v3-up">3. Vektorzahl -1 zu 1</option>
            ${currentMenu === 'news' ? '<option value="date-newest">Datum neu zu alt (nur News)</option><option value="date-oldest">Datum alt zu neu (nur News)</option>' : ''}
            <option value="faktor-down">7b-Faktor 1 zu -1</option>
            <option value="faktor-up">7b-Faktor -1 zu 1</option>
          `;
          select.value = sortMode;
          select.addEventListener('change', (e) => {
            sortMode = e.target.value;
            renderArticleList();
          });

          controls.appendChild(searchBox);
          controls.appendChild(select);

          const zufallBtn = document.createElement('button');
          zufallBtn.textContent = 'Zufälliger Artikel';
          zufallBtn.onclick = showRandomArticle;
          zufallBtn.style.padding = '10px';
          controls.appendChild(zufallBtn);
          content.appendChild(controls);

          const listContainer = document.createElement('div');
          listContainer.id = 'article-list';
          content.appendChild(listContainer);

          renderArticleList();
        } else {
          const datenSet = currentMenu === 'artikel' ? artikelDaten : newsDaten;
          const artikel = datenSet[currentArticle];
          content.innerHTML = '';
          const full = document.createElement('div');
          full.className = 'article-full';
          full.style.backgroundColor = kategorienFarben[artikel.kategorie] || '#ffffff';
          full.innerHTML = `
            <h2>${artikel.titel}</h2>
            ${artikel.datum ? `Datum: ${formatDatum(artikel.datum)}<br>` : ''}
            7b-Vektor: [${artikel.vektor.join(', ')}] (7b-Faktor: ${berechne7bFaktor(artikel.vektor)})<br>
            <img src="${artikel.bild}" alt="Artikelbild"><br>
            <div>${artikel.text}</div>
            <button onclick="switchMenu(currentMenu)">Zurück</button>
          `;
          content.appendChild(full);
        }
      }
    }

    function renderArticleList() {
      const daten = currentMenu === 'artikel' ? artikelDaten : newsDaten;
      const sorted = sortArticles(daten);
      const listContainer = document.getElementById('article-list');
      listContainer.innerHTML = '';
      sorted.forEach((artikel, index) => {
        if (artikel.titel.toLowerCase().includes(searchQuery)) {
          const summary = document.createElement('div');
          summary.className = 'article-summary';
          summary.style.backgroundColor = kategorienFarben[artikel.kategorie] || '#ffffff';
          summary.onclick = () => showArticle(daten.indexOf(artikel));
          summary.innerHTML = `
            <strong>${artikel.titel}</strong><br>
            Kategorie: ${artikel.kategorie}<br>
            ${artikel.datum ? `Datum: ${formatDatum(artikel.datum)}<br>` : ''}
            7b-Vektor: [${artikel.vektor.join(', ')}] (7b-Faktor: ${berechne7bFaktor(artikel.vektor)})<br>
            <img src="${artikel.bild}" alt="Artikelbild">
          `;
          listContainer.appendChild(summary);
        }
      });
    }

    switchMenu('hauptseite');
  </script>
</body>
</html>

